#/bin/sh

#mvn -q clean || exit 1
#mvn -q integration-test || exit 2
mvn -q package  || exit 3

WILDFLY=wildfly-10.1.0.Final
PROJECT=~/Documents/projects/podcasts
DOWNLOAD=~/Downloads/$WILDFLY.zip
INSTALL=~/bin
TARGET=wildfly

cd $INSTALL
test -d $TARGET && rm -rf $TARGET
cp $DOWNLOAD ./
unzip $WILDFLY.zip >/dev/null
rm $WILDFLY.zip
mv $WILDFLY $TARGET
cd $TARGET/standalone/configuration
rm standalone*.xml
cp $PROJECT/src/main/setup/standalone-dev.xml ./standalone.xml
ln -s standalone.xml standalone-full.xml
ln -s standalone.xml standalone-full-ha.xml
ln -s standalone.xml standalone-ha.xml
cd ../../..

./$TARGET/bin/add-user.sh admin admin --silent

cd $PROJECT
cp target/podcasts.war ~/bin/wildfly/standalone/deployments/
echo Done.
